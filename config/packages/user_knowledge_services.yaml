# config/packages/user_knowledge_services.yaml
# Service-Konfiguration f√ºr User Knowledge Base und Document Management

services:
    # ==================== Services ====================
    
    App\Service\UserKnowledgeService:
        arguments:
            $em: '@doctrine.orm.entity_manager'
            $knowledgeRepo: '@App\Repository\UserKnowledgeDocumentRepository'
            $platform: '@ai.platform.gemini'
            $logger: '@logger'
        tags:
            - { name: 'monolog.logger', channel: 'user_knowledge' }

    App\Service\UserDocumentService:
        arguments:
            $em: '@doctrine.orm.entity_manager'
            $documentRepo: '@App\Repository\UserDocumentRepository'
            $logger: '@logger'
            $uploadDirectory: '%kernel.project_dir%/var/user_uploads'
        tags:
            - { name: 'monolog.logger', channel: 'user_documents' }

    # ==================== Repositories ====================
    
    App\Repository\UserKnowledgeDocumentRepository:
        class: App\Repository\UserKnowledgeDocumentRepository
        arguments:
            - '@doctrine'
        tags:
            - { name: 'doctrine.repository_service' }

    App\Repository\UserDocumentRepository:
        class: App\Repository\UserDocumentRepository
        arguments:
            - '@doctrine'
        tags:
            - { name: 'doctrine.repository_service' }

    # ==================== AI Tools ====================
    
    App\Tool\UserKnowledgeSearchTool:
        arguments:
            $platform: '@ai.platform.gemini'
            $knowledgeRepo: '@App\Repository\UserKnowledgeDocumentRepository'
            $userRepository: '@App\Repository\UserRepository'
            $logger: '@logger'
        tags:
            - { name: 'ai.tool' }

    App\Tool\AddUserKnowledgeTool:
        arguments:
            $knowledgeService: '@App\Service\UserKnowledgeService'
            $userRepository: '@App\Repository\UserRepository'
            $logger: '@logger'
        tags:
            - { name: 'ai.tool' }

    # UserDocumentReadTool
    App\Tool\UserDocumentReadTool:
        arguments:
            $logger: '@logger'
            $documentRepo: '@App\Repository\UserDocumentRepository'
            $documentService: '@App\Service\UserDocumentService'
            $security: '@security.helper'
        tags: ['ai.tool']

    # UserDocumentListTool
    App\Tool\UserDocumentListTool:
        arguments:
            $logger: '@logger'
            $documentRepo: '@App\Repository\UserDocumentRepository'
            $security: '@security.helper'
        tags: ['ai.tool']

    # UserDocumentSearchTool
    App\Tool\UserDocumentSearchTool:
        arguments:
            $logger: '@logger'
            $documentRepo: '@App\Repository\UserDocumentRepository'
            $security: '@security.helper'
        tags: ['ai.tool']

    # UserDocumentMetadataTool
    App\Tool\UserDocumentMetadataTool:
        arguments:
            $logger: '@logger'
            $documentRepo: '@App\Repository\UserDocumentRepository'
            $security: '@security.helper'
        tags: ['ai.tool']
   